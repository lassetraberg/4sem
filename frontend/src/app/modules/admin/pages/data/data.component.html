<h2>Vehicle Data</h2>
<div class="buttons">
  <button class="btn" type="button" routerLink="/admin">
    <i class="material-icons">
      arrow_back
    </i>
  </button>
  <button class="btn" type="button" (click)="getVehicleData()">
    <i class="material-icons">
      refresh
    </i>
  </button>
</div>
<ng-template #noVehicleData>There is no vehicle data yet.</ng-template>
<mat-accordion *ngIf="hasVehicleData(); else noVehicleData">
  <mat-expansion-panel
    *ngFor="let data of vehicleData | keyvalue"
    expanded="false"
    class="scrolling-panel"
    hideToggle="true"
  >
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{ data.key }}
      </mat-panel-title>
      <mat-panel-description>
        {{ data.value.length }} records
      </mat-panel-description>

      <ng-template matExpansionPanelContent>
        <table mat-table [dataSource]="data.value">
          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef>Timestamp</th>
            <td mat-cell *matCellDef="let record">
              {{ formatDate(record.timestamp) }}
            </td>
          </ng-container>
          <ng-container matColumnDef="gps">
            <th mat-header-cell *matHeaderCellDef>GPS</th>
            <td mat-cell *matCellDef="let record">
              {{ record.gps.lat }}, {{ record.gps.lon }}
            </td>
          </ng-container>
          <ng-container matColumnDef="velocity">
            <th mat-header-cell *matHeaderCellDef>Velocity</th>
            <td mat-cell *matCellDef="let record">{{ record.velocity }}</td>
          </ng-container>
          <ng-container matColumnDef="speedLimit">
            <th mat-header-cell *matHeaderCellDef>Speed limit</th>
            <td mat-cell *matCellDef="let record">
              {{ record.speedLimit == 32767 ? "n/a" : record.speedLimit }}
            </td>
          </ng-container>
          <ng-container matColumnDef="acceleration">
            <th mat-header-cell *matHeaderCellDef>Acceleration</th>
            <td mat-cell *matCellDef="let record">{{ record.acceleration }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: tableColumns"></tr>
        </table>
      </ng-template>
    </mat-expansion-panel-header>
  </mat-expansion-panel>
</mat-accordion>
